<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××™×©×•×¨ ×’×™×œ ×•×§×‘×œ×ª ×§×•×¤×•×Ÿ - Premium Video BG</title>
    <!-- ×˜×¢×™× ×ª Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 1. ×”×’×“×¨×•×ª ×‘×¡×™×¡ ×•×¨×§×¢ ×¤×¨×™××™×•× (Dark Mode) */
        body {
            font-family: 'Inter', sans-serif;
            position: relative;
            min-height: 100vh;
            background-color: #030303; /* ×©×—×•×¨ ×¢××•×§ ×××•×“ */
            color: #e5e7eb; /* ×˜×§×¡×˜ ×‘×”×™×¨ */
            overflow-x: hidden; /* ××•× ×¢ ×’×œ×™×œ×” ××•×¤×§×™×ª */
        }

        /* ×”×’×“×¨×•×ª ×•×™×“××• ×¨×§×¢: ×›×™×¡×•×™ ××œ×, ×“×¨××˜×™ ×•×¡××‘×˜×™×œ×™ */
        #background-video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: 10;
            opacity: 0.2; /* ×”×•×’×‘×¨ ××¢×˜ ×œ××˜×™××•×ª ×¨×’×•×¢×” ×™×•×ª×¨ */
            filter: grayscale(100%); /* ××¨××” ×“×¨××˜×™ ××•× ×•×›×¨×•××˜×™ */
            object-fit: cover; /* ××•×•×“× ×©×”×•×™×“××• ××›×¡×” ××ª ×›×œ ×”××¡×š */
            transition: opacity 0.5s;
        }

        /* 2. ×©×›×‘×ª Overlay - ×›×”×” ×•×—×–×§×” ×›×“×™ ×œ×”×‘×˜×™×— ×§×¨×™××•×ª */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* ×¨×§×¢ Gradient ×œ×™×¦×™×¨×ª ××¤×§×˜ ×¢×•××§ (Radial Gradient) */
            background-image: radial-gradient(circle at center, rgba(0, 230, 118, 0.02) 0%, rgba(3, 3, 3, 0.9) 70%);
            z-index: 15;
        }
        
        /* 3. ×¢×™×¦×•×‘ ×”××•×ª×’ ×•×”×¦×‘×¢×™× */
        .brand-green { background-color: #00E676; } 
        .brand-green:hover { background-color: #00c765; }
        .whatsapp-green { background-color: #25D366; }
        .whatsapp-green:hover { background-color: #128C7E; }

        /* 4. ×¢×™×¦×•×‘ ×”×›×¨×˜×™×¡ ×”××¨×›×–×™ */
        .modal-card {
            z-index: 20;
            backdrop-filter: blur(20px); 
            background-color: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(0, 230, 118, 0.5);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        /* 5. ×¢×™×¦×•×‘ ×©×“×•×ª ×§×œ×˜ */
        .form-input {
            background-color: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(156, 163, 175, 0.3); 
            color: #fff;
        }
        .form-input:focus {
            background-color: #1f2937;
            border-color: #00E676;
            box-shadow: 0 0 0 1px #00E676;
        }

        /* ×›×¤×ª×•×¨ × ×™××•×Ÿ ×‘×•×œ×˜ ×™×•×ª×¨ */
        .neon-cta-button {
            box-shadow: 0 0 20px rgba(37, 211, 102, 0.6), inset 0 0 10px rgba(37, 211, 102, 0.4); 
        }
        .neon-cta-button:hover {
            box-shadow: 0 0 30px rgba(37, 211, 102, 0.8), inset 0 0 15px rgba(37, 211, 102, 0.6);
        }

        /* ×›×¨×˜×™×¡ ×”×•×“×¢×•×ª */
        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            width: 90%;
            max-width: 400px;
            text-align: right;
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <!-- ×”×•×“×¢×ª ×˜×¢×™× ×” / ×©×’×™××” - × ×¡×ª×¨×ª ×›×‘×¨×™×¨×ª ××—×“×œ -->
    <div id="loading-message" class="message-box bg-gray-800 p-4 rounded-lg shadow-xl border border-yellow-500 hidden">
        <p class="text-lg text-yellow-300 font-bold">×˜×•×¢×Ÿ ×¨×§×¢ ×•×™×“××•...</p>
        <p class="text-sm text-gray-400">×× ×”×”×•×“×¢×” × ×©××¨×ª, ×× × ×•×“× ×©×”×§×™×©×•×¨ ×œ-MP4 ×ª×§×™×Ÿ.</p>
    </div>

    <!-- ×”×•×“×¢×ª ×”×¦×œ×—×” - × ×¡×ª×¨×ª ×›×‘×¨×™×¨×ª ××—×“×œ -->
    <div id="success-message" class="message-box bg-gray-900 p-8 rounded-xl shadow-2xl border border-brand-green hidden">
        <h2 class="text-3xl font-extrabold text-brand-green mb-3">âœ… ××™×©×•×¨ ×”×¦×œ×—×”!</h2>
        <p class="text-white text-lg mb-6">×¤×¨×˜×™×š × ×§×œ×˜×• ×‘×”×¦×œ×—×”. ×§×•×“ ×”×”× ×—×” × ×©×œ×— ××œ×™×š ×œ××›×©×™×¨×š ×‘×•×•××˜×¡××¤.</p>
        <button id="redirectToStore" class="neon-cta-button w-full flex justify-center items-center py-3 px-6 rounded-xl text-lg font-black text-gray-900 brand-green focus:outline-none focus:ring-8 focus:ring-offset-2 focus:ring-whatsapp-green/70 transition duration-300 ease-in-out">
            ××¢×‘×¨ ×œ×—× ×•×ª Apollo
        </button>
    </div>


    <!-- 1. ×¨×§×¢ ×•×™×“××• ×“×¨××˜×™ ×•×¡××‘×˜×™×œ×™ -->
    <video autoplay muted loop id="background-video" preload="auto" class="hidden">
        <!-- ×§×™×©×•×¨ ×•×™×“××• ×—×“×©: ×¨×’×•×¢, ××§×¦×•×¢×™ ×•×˜×‘×¢×™, ×•×—×©×•×‘ ××›×œ - ×‘-HTTPS! -->
        <source src="https://storage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4" type="video/mp4">
        
        <!-- Fallback (××•×¦×’ ×× ×”×•×™×“××• ×œ× × ×˜×¢×Ÿ) -->
        <img src="https://placehold.co/1920x1080/030303/00E676?text=VIDEO+FALLBACK+EFFECT" alt="×¨×§×¢ ×•×™×“××• ××•× ×¤×©" style="width: 100%; height: 100%; object-fit: cover; opacity: 1; z-index: 10; position: fixed;">
    </video>

    <!-- 2. ×©×›×‘×ª ×¢×œ ×›×”×” -->
    <div class="overlay"></div>

    <!-- ×›×¨×˜×™×¡ ×“×£ ×”× ×—×™×ª×” ×”××¨×›×–×™ -->
    <div id="landing-card" class="modal-card max-w-lg w-full rounded-3xl p-10 space-y-8">

        <!-- ×›×•×ª×¨×ª ×¨××©×™×ª H1: ×”×”×‘×˜×—×” -->
        <h1 class="text-4xl font-extrabold text-white text-center leading-snug tracking-wide">
            ğŸŒ¿ ×¤×•×¨×˜×œ ×¤×¨×™××™×•× × ×¤×ª×—: ×§×•×“ ×”× ×—×” ×•×’×™×©×” ××™×™×“×™×ª ×œ-Apollo
        </h1>

        <!-- ×›×•×ª×¨×ª ××©× ×” H2: ×”×“×’×© ×¢×œ ××—×¨×™×•×ª -->
        <p class="text-gray-300 text-center text-base font-light">
            ×¢×œ ×¤×™ ×“×¨×™×©×•×ª ×”×¨×’×•×œ×¦×™×”: ×× × ××©×¨/×™ ××ª ×’×™×œ×š **(18+)** ×•×”×¡×›××” ××œ××” ×œ×ª× ××™ ×”×©×™××•×© ×©×œ× ×• ×›×“×™ ×œ×”×©×œ×™× ××ª ×”×¨×™×©×•×.
        </p>

        <!-- ×˜×•×¤×¡ ××™××•×ª ×•×œ×™×“×™× -->
        <form id="ageGateForm" class="space-y-6">
            <!-- ×”×•×“×¢×•×ª ×©×’×™××” ×’×œ×•×‘×œ×™×•×ª -->
            <div id="error-message" class="hidden p-4 bg-red-900/50 border border-red-500 text-red-300 rounded-lg text-sm text-right font-semibold">
                ××™××•×ª × ×›×©×œ. ×•×“×/×™ ×©×”× ×š ××¢×œ ×’×™×œ 18 ×•×©×›×œ ×”×©×“×•×ª ×¡×•×× ×• ×•××•×œ××• ×›× ×“×¨×©.
            </div>

            <!-- 1. ××™××•×ª ×’×™×œ (×©×“×” ×—×•×‘×”) -->
            <div class="space-y-2">
                <label for="birthDate" class="block text-sm font-bold text-gray-200">1. ×ª××¨×™×š ×œ×™×“×” ××œ× (DD/MM/YYYY):</label>
                <input type="date" id="birthDate" name="birthDate" required class="form-input mt-1 block w-full px-4 py-3 rounded-xl focus:outline-none text-lg placeholder-gray-500">
            </div>

            <!-- 2. ×œ×›×™×“×ª ×œ×™×“×™× (××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×œ×•×•×˜×¡××¤ - ×©×“×” ×—×•×‘×”) -->
            <div class="space-y-2">
                <label for="phoneNumber" class="block text-sm font-bold text-gray-200">2. ××¡×¤×¨ ×˜×œ×¤×•×Ÿ (×•×•××˜×¡××¤) ×œ×§×‘×œ×ª ×§×•×“ ×”×”× ×—×”:</label>
                <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="05X-XXXXXXX" minlength="9" class="form-input mt-1 block w-full px-4 py-3 rounded-xl focus:outline-none text-lg placeholder-gray-500">
            </div>

            <!-- 3. ×©× ×¤×¨×˜×™ (×¨×©×•×ª) -->
            <div class="space-y-2">
                <label for="fullName" class="block text-sm font-medium text-gray-400">3. ×©× ×¤×¨×˜×™ (××•×¤×¦×™×•× ×œ×™):</label>
                <input type="text" id="fullName" name="fullName" placeholder="×©××š ×”××œ×" class="form-input mt-1 block w-full px-4 py-3 rounded-xl focus:outline-none placeholder-gray-500">
            </div>


            <!-- 4. ××™×©×•×¨ ×ª× ××™× ×¨×’×•×œ×˜×•×¨×™ (Checkboxes) -->
            <div class="space-y-4 pt-3 text-right">
                <div class="flex items-start">
                    <input id="ageCheck" name="ageCheck" type="checkbox" required class="h-5 w-5 text-brand-green border-gray-600 rounded focus:ring-brand-green mt-1 bg-gray-700">
                    <label for="ageCheck" class="mr-3 text-base text-gray-300 cursor-pointer font-semibold">
                        ×× ×™ ×××©×¨/×ª ×©×× ×™ ×¢×•××“/×ª ×‘×“×¨×™×©×•×ª ×’×™×œ ×”××™× ×™××•× ×”×—×•×§×™ **(18+)**.
                    </label>
                </div>
                <div class="flex items-start">
                    <input id="termsCheck" name="termsCheck" type="checkbox" required class="h-5 w-5 text-brand-green border-gray-600 rounded focus:ring-brand-green mt-1 bg-gray-700">
                    <label for="termsCheck" class="mr-3 text-base text-gray-300 cursor-pointer font-semibold">
                        ×× ×™ ×××©×¨/×ª ×©×§×¨××ª×™ ×•×”×¡×›××ª×™ ×œ<a href="#terms-and-privacy" class="text-brand-green hover:underline font-bold transition duration-150">×ª× ××™ ×”×©×™××•×© ×•××“×™× ×™×•×ª ×”×¤×¨×˜×™×•×ª</a>.
                    </label>
                </div>
            </div>

            <!-- ×›×¤×ª×•×¨ ×§×¨×™××” ×œ×¤×¢×•×œ×” (CTA) - × ×™××•×Ÿ ×—×–×§ -->
            <button type="submit" class="neon-cta-button w-full flex justify-center items-center py-4 px-6 rounded-xl text-xl font-black text-gray-900 brand-green focus:outline-none focus:ring-8 focus:ring-offset-2 focus:ring-whatsapp-green/70 transition duration-300 ease-in-out transform hover:scale-[1.02]">
                ××™×©×•×¨ ×•×›× ×™×¡×” ××™×™×“×™×ª
            </button>
        </form>

        <!-- ×¡×™×™×’ ×¨×¤×•××™ (Disclaimer) ×§×˜×Ÿ ×‘×ª×—×ª×™×ª ×”×›×¨×˜×™×¡ -->
        <p class="text-xs text-gray-500 text-center pt-2">
            ×¡×™×™×’: ×”××™×“×¢ ××™× ×• ××”×•×•×” ×ª×—×œ×™×£ ×œ×™×™×¢×•×¥ ×¨×¤×•××™ ××• ××©×¤×˜×™.
        </p>
    </div>

    <!-- ×¤×•×˜×¨ ××©×•×“×¨×’ ×¢× ×¨×§×¢ ×›×”×” -->
    <footer id="terms-and-privacy" class="fixed bottom-0 w-full bg-gray-900/95 backdrop-blur-lg p-3 text-center text-xs text-gray-500 border-t border-gray-800 z-30 shadow-2xl">
        &copy; 2024 **APOLLO** | ×—×‘×¨×” ×œ×”×¤×¦×” ×-2020. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.
        <br>
        ×”×©×™××•×© ×‘××ª×¨ ×›×¤×•×£ ×œ×—×•×§×™ ×”××“×™× ×” ×•××•×ª×¨ ×¨×§ ×œ××©×ª××©×™× ××¢×œ ×’×™×œ **18**.
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ×”×’×“×¨×•×ª ×’×œ×•×‘×œ×™×•×ª × ×“×¨×©×•×ª ×©×œ Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        // ××©×ª× ×™ Firebase
        let db;
        let auth;
        let isFirebaseReady = false;

        // ×˜×•×¢×Ÿ ×¨×›×™×‘×™ UI
        const videoElement = document.getElementById('background-video');
        const loadingMessage = document.getElementById('loading-message');
        const successMessage = document.getElementById('success-message');
        const landingCard = document.getElementById('landing-card');
        const formElement = document.getElementById('ageGateForm');
        const errorMessage = document.getElementById('error-message');
        const redirectToStoreButton = document.getElementById('redirectToStore');
        const STORE_URL = 'https://apollosystem.io';


        // --- 1. ××ª×—×•×œ Firebase ×•××™××•×ª ---
        if (Object.keys(firebaseConfig).length > 0) {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // ××™××•×ª ××©×ª××© ×‘×××¦×¢×•×ª Custom Token ××• ×›× ×™×¡×” ×× ×•× ×™××™×ª
            const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
            
            const authenticate = (signInFunc) => {
                signInFunc(auth, token)
                    .then(() => {
                        isFirebaseReady = true;
                        console.log("Firebase signed in successfully.");
                    })
                    .catch(error => {
                        console.error("Firebase authentication error:", error);
                        // ×× ×”×›× ×™×¡×” × ×›×©×œ×”, ×× ×¡×™× ×›× ×™×¡×” ×× ×•× ×™××™×ª
                        signInAnonymously(auth).then(() => {
                             isFirebaseReady = true;
                             console.log("Firebase signed in anonymously as fallback.");
                        });
                    });
            };

            if (token) {
                 authenticate(signInWithCustomToken);
            } else {
                 authenticate(signInAnonymously);
            }
        } else {
            console.error("Firebase config is missing or empty. Leads will not be saved.");
        }


        // --- 2. ×œ×•×’×™×§×ª ×©××™×¨×ª ×œ×™×“ ---
        async function saveLead(data) {
            if (!isFirebaseReady || !db) {
                console.error("Firestore not ready or initialized. Cannot save lead.");
                return false;
            }

            try {
                const userId = auth.currentUser?.uid || 'anonymous';
                // × ×ª×™×‘: /artifacts/{appId}/users/{userId}/leads
                const leadsCollectionRef = collection(db, 'artifacts', appId, 'users', userId, 'leads');
                
                await addDoc(leadsCollectionRef, {
                    name: data.name,
                    phone: data.phone,
                    birthDate: data.birthDate,
                    age: data.age,
                    timestamp: serverTimestamp(),
                    source: 'ApolloLandingPage'
                });

                console.log("Lead saved successfully to Firestore.");
                return true;
            } catch (e) {
                console.error("Error adding document to Firestore: ", e);
                return false;
            }
        }

        // --- 3. ×œ×•×’×™×§×ª ×”×¤×¢×œ×ª ×•×™×“××• ×¨×§×¢ ---

        // ×”×¦×’×ª ×”×•×“×¢×ª ×˜×¢×™× ×” ×¢×“ ×©×”×•×™×“××• ××•×›×Ÿ
        loadingMessage.classList.remove('hidden');

        // ×¤×•× ×§×¦×™×” ×œ× ×™×¡×™×•×Ÿ × ×’×™× ×” (×—×•×‘×” ×¢×§×‘ ××“×™× ×™×•×ª ×“×¤×“×¤× ×™×)
        function attemptPlay() {
            const playPromise = videoElement.play();

            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // ×”×•×™×“××• ×”×ª×—×™×œ ×œ× ×’×Ÿ ×‘×”×¦×œ×—×” - ×”×¡×ª×¨ ××ª ×”×•×“×¢×ª ×”×˜×¢×™× ×”
                    loadingMessage.classList.add('hidden');
                    videoElement.classList.remove('hidden');
                    console.log('Video started successfully.');
                }).catch(error => {
                    // × ×›×©×œ ×‘× ×™×’×•×Ÿ ××•×˜×•××˜×™
                    loadingMessage.textContent = '×”×•×•×™×“××• ×œ× × ×˜×¢×Ÿ ××• × ×—×¡× ××•×˜×•××˜×™×ª. ××•×¦×’×ª ×ª××•× ×ª ×¨×§×¢ ×¡×˜×˜×™×ª ×‘××§×•×.';
                    videoElement.classList.add('hidden');
                    console.error('Video Autoplay failed:', error);
                });
            }
        }

        // ×•×“× ×©×”×•×™×“××• × ×˜×¢×Ÿ ×œ×—×œ×•×˜×™×Ÿ ×œ×¤× ×™ ×”× ×™×¡×™×•×Ÿ
        videoElement.addEventListener('loadeddata', () => {
             attemptPlay();
        });

        // ×× ×”×•×™×“××• ×›×‘×¨ ×”×™×” ×‘××¦×‘ ×˜×¢×•×Ÿ ××¨××©
        if (videoElement.readyState >= 2) {
            attemptPlay();
        } else {
             // ×× ×œ×•×§×— ×™×•×ª×¨ ××©× ×™×™×” ×œ×˜×¢×•×Ÿ, × ×¦×™×’ ×”×•×“×¢×”
             setTimeout(() => {
                if (videoElement.classList.contains('hidden')) {
                     loadingMessage.classList.remove('hidden');
                }
             }, 1000);
        }

        // --- 4. ×œ×•×’×™×§×ª ××™××•×ª ×•×©×™×’×•×¨ ×”×˜×•×¤×¡ ---
        formElement.addEventListener('submit', async function(e) {
            e.preventDefault();

            const MINIMUM_AGE = 18; 
            
            const birthDateInput = document.getElementById('birthDate').value;
            const phoneNumberInput = document.getElementById('phoneNumber').value.replace(/[^0-9]/g, ''); 
            const fullNameInput = document.getElementById('fullName').value;
            const ageCheck = document.getElementById('ageCheck').checked;
            const termsCheck = document.getElementById('termsCheck').checked;

            const today = new Date();
            const birthDate = new Date(birthDateInput);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            // 1. ×‘×“×™×§×ª ×ª×§×™× ×•×ª × ×ª×•× ×™×
            if (age < MINIMUM_AGE || !birthDateInput || phoneNumberInput.length < 9 || !ageCheck || !termsCheck) {
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = '××™××•×ª ×›× ×™×¡×” × ×›×©×œ. ×× × ×•×“×/×™ ×©×”× ×š ××¢×œ ×’×™×œ ' + MINIMUM_AGE + ', ×©×”××¡×¤×¨ ×ª×§×™×Ÿ ×•××™×œ××ª ××ª ×›×œ ×”×©×“×•×ª.';
                return;
            }

            errorMessage.classList.add('hidden');

            // 2. ×©××™×¨×ª ×”×œ×™×“ ×œ-Firestore
            const leadData = {
                name: fullNameInput || '×œ× ×¡×•×¤×§',
                phone: phoneNumberInput,
                birthDate: birthDateInput,
                age: age,
            };

            const saveSuccessful = await saveLead(leadData);

            if (saveSuccessful) {
                // 3. ×”×¦×’×ª ×”×•×“×¢×ª ×”×¦×œ×—×”
                landingCard.classList.add('hidden');
                loadingMessage.classList.add('hidden');
                successMessage.classList.remove('hidden');
                console.log("Form submitted and lead saved.");
            } else {
                // ×× ×”×©××™×¨×” × ×›×©×œ×”, ×¢×“×™×™×Ÿ × ×¦×™×’ ×”×•×“×¢×ª ×©×’×™××” ×§×œ×”, ××‘×œ ×œ× × ×—×¡×•× ×œ×’××¨×™ (×™×™×ª×›×Ÿ ×©×–×” ×™×¦×™×’ ××ª ×”×œ×™×“ ×‘××§×•× ××—×¨)
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = '××™××•×ª ×¢×‘×¨, ××š ××™×¨×¢×” ×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×. × × ×¡×” ×œ×”×¤× ×•×ª ××•×ª×š ×‘×›×œ ×–××ª.';
                
                // fallback redirect
                setTimeout(() => {
                    window.location.href = STORE_URL;
                }, 3000);
            }
        });

        // 5. × ×™×•×•×˜ ×œ×—× ×•×ª ×œ××—×¨ ×”×”×¦×œ×—×”
        redirectToStoreButton.addEventListener('click', () => {
            window.location.href = STORE_URL;
        });

    </script>
</body>
</html>
