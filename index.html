<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="pageTitle">אימות גיל וגישה מיידית - רקע מונפש</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* 1. Base Settings and Premium Dark Mode Background */
        body {
            font-family: 'Inter', sans-serif;
            position: relative;
            min-height: 100vh;
            background-color: #030303; /* Deep Black - Fallback */
            color: #e5e7eb; /* Light Text */
            padding-top: 1rem; /* Top spacing */
            padding-bottom: 8rem; /* Bottom spacing for fixed footer */
        }

        /* 2. New Animated Background Settings (Pure CSS) */
        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            /* Large gradient (400% 400%) for slow movement */
            background: linear-gradient(-45deg, #0d131f, #030303, #00E676, #0d131f);
            background-size: 400% 400%;
            opacity: 0.5; /* Keeps the glow subtle */
            transition: opacity 0.5s;
            animation: gradientMove 24s ease infinite; 
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 3. Overlay Layer - Dark and strong for readability */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Aggressive layer to emphasize content */
            background-image: radial-gradient(circle at center, rgba(0, 230, 118, 0.02) 0%, rgba(3, 3, 3, 0.88) 70%);
            z-index: 15;
        }
        
        /* 4. Brand Design and Colors */
        .brand-green { background-color: #00E676; } 
        .brand-green:hover { background-color: #00c765; }
        .whatsapp-green { background-color: #25D366; }
        .whatsapp-green:hover { background-color: #128C7E; }

        /* 5. Central Card Design (Glass-morphism) */
        .modal-card {
            z-index: 20;
            backdrop-filter: blur(20px); 
            background-color: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(0, 230, 118, 0.5);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            margin-top: 3rem;
            margin-bottom: 3rem;
        }

        /* 6. Input Field Styling */
        .form-input {
            background-color: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(156, 163, 175, 0.3); 
            color: #fff;
        }
        .form-input:focus {
            background-color: #1f2937;
            border-color: #00E676;
            box-shadow: 0 0 0 1px #00E676;
        }

        /* Neon CTA Button */
        .neon-cta-button {
            box-shadow: 0 0 20px rgba(37, 211, 102, 0.6), inset 0 0 10px rgba(37, 211, 102, 0.4); 
        }
        .neon-cta-button:hover {
            box-shadow: 0 0 30px rgba(37, 211, 102, 0.8), inset 0 0 15px rgba(37, 211, 102, 0.6);
        }

        /* Message Box / Modals - General Styling */
        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            width: 90%;
            max-width: 400px;
            text-align: right; /* Changed default to RTL for initial load */
        }

        /* Full Screen Policy Modal */
        #policy-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(8px);
            z-index: 100;
            display: none; /* Hidden by default */
            padding: 20px; 
            overflow-y: auto; /* Fallback for very small screens */
        }

        /* CRITICAL FIX: Make the content box a flexible container that fills the height */
        .policy-content-box {
            background-color: #111827;
            border: 1px solid #00E676;
            box-shadow: 0 0 30px rgba(0, 230, 118, 0.4);
            max-width: 800px;
            margin: 0 auto; 
            padding: 30px; /* Slightly reduced padding */
            
            /* Flexible Layout for scrollable content area */
            display: flex;
            flex-direction: column;
            
            /* Ensures the box fills max height available within the 40px vertical padding */
            height: auto; 
            min-height: 50vh;
            max-height: calc(100vh - 40px); 
        }

        /* Target the content area to allow internal scrolling */
        #policy-content {
            flex-grow: 1; /* Allows content area to take up available space */
        }

        /* 7. Footer - Fixed to the bottom, allowing body content to scroll */
        .footer-fixed {
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 30;
        }
        
        /* 8. Floating WhatsApp Button Style */
        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 20px;
            right: 20px; /* Standard bottom-right position */
            background-color: #25D366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            /* Font size applies to the icon inside */
            font-size: 30px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(37, 211, 102, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0);
            }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-start p-4 min-h-screen">
    
    <!-- MODAL: מדיניות פרטיות ותנאי שימוש -->
    <div id="policy-modal" class="hidden">
        <div class="policy-content-box rounded-xl">
            <h2 id="policy-title" class="text-4xl font-extrabold text-[#00E676] mb-6 text-center" data-lang-key="policyTitle"></h2>
            
            <div id="policy-content" class="text-gray-300 space-y-4 leading-relaxed overflow-y-auto pr-2" data-lang-key="policyContent">
                <!-- Content injected by JS -->
            </div>

            <div class="mt-8 text-center flex-shrink-0">
                <button id="close-policy-modal" class="py-3 px-8 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-xl transition duration-200">
                    סגור (חזור לטופס)
                </button>
            </div>
        </div>
    </div>


    <button id="lang-toggle" class="fixed top-4 right-4 z-50 p-2 bg-gray-700/80 backdrop-blur-sm rounded-full text-white font-bold text-sm shadow-lg hover:bg-gray-600 transition duration-150">
        EN / HE
    </button>
    
    <!-- כפתור מנהל מערכת (פעיל כעת) -->
    <button id="admin-view-btn" class="fixed top-4 left-4 z-50 p-2 bg-gray-900/70 backdrop-blur-sm rounded-full text-xl shadow-lg hover:bg-gray-800 transition duration-150 text-white hover:text-[#00E676] hover:shadow-[0_0_15px_#00E676]" aria-label="Admin View">
        🕊️
    </button>


    <!-- SUCCESS MESSAGE (No Coupon) -->
    <div id="success-message" class="message-box bg-gray-900 p-8 rounded-xl shadow-2xl border border-brand-green hidden">
        <h2 class="text-3xl font-extrabold text-white mb-3" data-lang-key="successTitle">✅ אימות הצלחה!</h2>
        
        <p class="text-gray-300 text-lg mb-4" data-lang-key="successText">גילך אומת בהצלחה. כעת יש לך גישה מיידית לפלטפורמה המלאה.</p>
        
        <!-- Removed Coupon Display Block -->
        
        <p class="text-gray-400 mb-6" data-lang-key="successFinalCta">
            האימות בוצע בהצלחה. לחץ מטה למעבר מיידי לאתר הראשי.
        </p>

        <button id="completeAction" class="neon-cta-button w-full flex justify-center items-center py-3 px-6 rounded-xl text-lg font-black text-gray-900 brand-green focus:outline-none focus:ring-8 focus:ring-offset-2 focus:ring-whatsapp-green/70 transition duration-300 ease-in-out" data-lang-key="successButton">
            מעבר מיידי לאתר APOLLO
        </button>
    </div>

    <div class="animated-background"></div>

    <div class="overlay"></div>

    <div id="landing-card" class="modal-card max-w-lg w-full rounded-3xl p-10 space-y-8">

        <h1 class="text-4xl font-extrabold text-white text-center leading-snug tracking-wide" data-lang-key="mainTitle">
            <!-- Text content will be set by JavaScript based on current language -->
        </h1>

        <p class="text-gray-300 text-center text-base font-light" data-lang-key="subtitle">
            בהתאם לרגולציה: אנא אשר/י את גילך (**18+**) והסכמתך המלאה לתנאי השימוש שלנו כדי לקבל גישה.
        </p>

        <form name="apollo-lead" id="ageGateFormNetlify" data-netlify="true" method="POST" class="space-y-6">
            
            <input type="hidden" name="form-name" value="apollo-lead" /> 

            <div id="error-message" class="hidden p-4 bg-red-900/50 border border-red-500 text-red-300 rounded-lg text-sm text-right font-semibold" data-lang-key="errorMsg">
                אימות נכשל. אנא ודא/י שאתה מעל גיל 18 ושכל שדות החובה סומנו ומולאו כראוי.
            </div>

            <div class="space-y-2">
                <label for="birthDate" class="block text-sm font-bold text-gray-200" data-lang-key="labelBirthDate">1. תאריך לידה מלא (DD/MM/YYYY):</label>
                <input type="date" id="birthDate" name="birthDate" required class="form-input mt-1 block w-full px-4 py-3 rounded-xl focus:outline-none text-lg placeholder-gray-500">
            </div>

            <div class="space-y-4 pt-3 text-right">
                <div class="flex items-start">
                    <input id="ageCheck" name="ageCheck" type="checkbox" required class="h-5 w-5 text-brand-green border-gray-600 rounded focus:ring-brand-green mt-1 bg-gray-700">
                    <label for="ageCheck" class="mr-3 text-base text-gray-300 cursor-pointer font-semibold" data-lang-key="checkAge">
                        אני מאשר/ת שאני עומד/ת בדרישות גיל המינימום החוקי (**18+**).
                    </label>
                </div>
                <div class="flex items-start">
                    <input id="termsCheck" name="termsCheck" type="checkbox" required class="h-5 w-5 text-brand-green border-gray-600 rounded focus:ring-brand-green mt-1 bg-gray-700">
                    <label for="termsCheck" class="mr-3 text-base text-gray-300 cursor-pointer font-semibold" data-lang-key="checkTerms">
                        אני מאשר/ת שקראתי והסכמתי ל<a href="#" id="policyLink" class="text-brand-green hover:underline font-bold transition duration-150">תנאי השימוש ומדיניות הפרטיות</a>.
                    </label>
                </div>
            </div>

            <button type="submit" class="neon-cta-button w-full flex justify-center items-center py-4 px-6 rounded-xl text-xl font-black text-gray-900 brand-green focus:outline-none focus:ring-8 focus:ring-offset-2 focus:ring-whatsapp-green/70 transition duration-300 ease-in-out transform hover:scale-[1.02]" data-lang-key="ctaButton">
                אישור וקבלת גישה מיידית
            </button>
        </form>

        <p class="text-xs text-gray-500 text-center pt-2" data-lang-key="disclaimer">
            סייג: המידע אינו מהווה ייעוץ רפואי או משפטי.
        </p>
    </div>

    <footer class="footer-fixed bg-gray-900/95 backdrop-blur-lg p-3 text-center text-xs text-gray-500 border-t border-gray-800 shadow-2xl">
        <span data-lang-key="footerLine1">&copy; APOLLO |כיוונים חברת הפצה משנת 2020. כל הזכויות שמורות.</span>
        <br>
        <span data-lang-key="footerLine2">השימוש באתר כפוף לחוקים המקומיים ומותר רק למשתמשים **מעל גיל 18**.</span>
    </footer>

    <a href="#" id="whatsapp-float-btn" class="whatsapp-float hover:scale-110 transition duration-200" title="צ׳אט מהיר בוואטסאפ">
        <i class="fab fa-whatsapp"></i>
    </a>

    <script type="module">
        // =======================================================
        // 0. Language Configuration
        // =======================================================
        const LANGUAGES = {
            'en': {
                'pageTitle': 'APOLLO: Age & Consent Verification',
                'mainTitle': 'Welcome to APOLLO! Quick Age Verification (18+)', 
                'subtitle': 'Before accessing the platform, please confirm you are 18+ and accept our Terms and Privacy Policy.', 
                'errorMsg': 'Oops! Verification check failed. Please ensure you are 18+ and all required fields are marked correctly.', 
                'labelBirthDate': '1. Full Date of Birth (DD/MM/YYYY):',
                'checkAge': 'I confirm that I meet the legal minimum age requirement **(18+)**.',
                'checkTerms': 'I confirm that I have read and agreed to the <a href="#" id="policyLink" class="text-brand-green hover:underline font-bold transition duration-150">Terms of Use and Privacy Policy</a>.',
                'ctaButton': 'Confirm Age & Get Instant Access', 
                'disclaimer': 'Regulatory Disclaimer: The information provided does not constitute professional medical or legal advice.',
                'footerLine1': '&copy; APOLLO. All Rights Reserved. Distribution company since 2020.',
                'footerLine2': 'Access is permitted only to users **aged 18 and over** and is subject to local laws.', 
                'successTitle': '✅ Access Granted!', 
                // UPDATED TEXT (No coupon)
                'successText': 'Your age confirmation was successful. You now have instant access to the full platform.', 
                // UPDATED TEXT (No coupon)
                'successFinalCta': 'Verification completed successfully. Click below for immediate redirection to the main website.',
                // UPDATED BUTTON TEXT (No coupon)
                'successButton': 'Go to APOLLO Now', 
                'loadingTitle': 'Animated Background Loading...',
                'loadingText': 'Form displayed successfully.',
                'policyTitle': 'Apollo Privacy Policy and Terms of Use',
                'policyContent': `
                    <h3 class="text-2xl font-bold text-white mb-3">1. Scope and Minimum Age</h3>
                    <p>This document outlines the privacy policy and terms of use for the Apollo access portal. Use is strictly limited to individuals who are <strong>18 years of age or older</strong>, in compliance with applicable local laws.</p>
                    
                    <h3 class="text-2xl font-bold text-white mt-6 mb-3">2. Data Collection</h3>
                    <p>The system collects the absolute minimum data required solely for age verification and access issuance:</p>
                    <ul class="list-disc list-inside ml-4 text-gray-400">
                        <li><strong>Date of Birth:</strong> Used exclusively to calculate and verify the user meets the 18+ minimum age requirement.</li>
                        <li><strong>Checkboxes:</strong> Confirmation of age requirement and agreement to these terms.</li>
                    </ul>
                    <p class="text-yellow-400 font-semibold mt-2">No personal identifying information (PII) such as Full Name, Email, or Phone Number is collected or stored by this specific portal, as these are handled by the main website registration system.</p>

                    <h3 class="text-2xl font-bold text-white mt-6 mb-3">3. Data Usage and Storage</h3>
                    <p>Collected data (Date of Birth, Checkbox status) is immediately submitted to our backend (Netlify Forms, or equivalent) only to record the successful verification event. We do not store this data locally. It is used solely for regulatory compliance purposes and to enable immediate site access.</p>

                    <h3 class="text-2xl font-bold text-white mt-6 mb-3">4. Terms of Access</h3>
                    <p>By proceeding, you confirm that you are over 18 and agree to all terms and conditions of the Apollo main platform. <strong>Please note: The sale of products and services is permitted solely under a valid and regulated license.</strong> You will be immediately redirected to the main site.</p>
                `,
            },
            'he': {
                'pageTitle': 'אימות גיל וגישה מיידית - רקע מונפש',
                'mainTitle': 'כיוון שיעשה לכם ראש שקט: APOLLO',
                'subtitle': 'בהתאם לרגולציה: אנא אשר/י את גילך (**18+**) והסכמתך המלאה לתנאי השימוש שלנו כדי לקבל גישה.',
                'errorMsg': 'אימות נכשל. אנא ודא/י שאתה מעל גיל 18 ושכל שדות החובה סומנו ומולאו כראוי.',
                'labelBirthDate': '1. תאריך לידה מלא (DD/MM/YYYY):',
                'checkAge': 'אני מאשר/ת שאני עומד/ת בדרישות גיל המינימום החוקי (**18+**).',
                'checkTerms': 'אני מאשר/ת שקראתי והסכמתי ל<a href="#" id="policyLink" class="text-brand-green hover:underline font-bold transition duration-150">תנאי השימוש ומדיניות הפרטיות</a>.',
                'ctaButton': 'אישור וקבלת גישה מיידית',
                'disclaimer': 'סייג: המידע אינו מהווה ייעוץ רפואי או משפטי.',
                'footerLine1': '&copy; APOLLO | חברת הפצה משנת 2020. כל הזכויות שמורות.',
                'footerLine2': 'השימוש באתר כפוף לחוקים המקומיים ומותר רק למשתמשים **מעל גיל 18**.',
                'successTitle': '✅ אימות הצלחה!',
                // UPDATED TEXT (No coupon)
                'successText': 'גילך אומת בהצלחה. כעת יש לך גישה מיידית לפלטפורמה המלאה.',
                // UPDATED TEXT (No coupon)
                'successFinalCta': 'האימות בוצע בהצלחה. לחץ מטה למעבר מיידי לאתר הראשי.',
                // UPDATED BUTTON TEXT (No coupon)
                'successButton': 'מעבר מיידי לאתר APOLLO', 
                'loadingTitle': 'טעינת רקע מונפש...',
                'loadingText': 'הטופס נטען בהצלחה.',
                'policyTitle': 'מדיניות פרטיות ותנאי שימוש (Apollo)',
                'policyContent': `
                    <h3 class="text-2xl font-bold text-white mb-3">1. תחולה וגיל מינימלי</h3>
                    <p>מסמך זה מפרט את מדיניות הפרטיות ותנאי השימוש של פורטל הגישה Apollo. השימוש מוגבל אך ורק לאנשים שגילם <strong>18 שנים ומעלה</strong>, בהתאם לחוקים המקומיים הרלוונטיים.</p>
                    
                    <h3 class="text-2xl font-bold text-white mt-6 mb-3">2. איסוף נתונים</h3>
                    <p>המערכת אוספת את המידע המינימלי הנדרש אך ורק לאימות גיל והנפקת גישה:</p>
                    <ul class="list-disc list-inside ml-4 text-gray-400">
                        <li><strong>תאריך לידה:</strong> משמש באופן בלעדי לחישוב ואימות שהמשתמש עומד בדרישת גיל 18+.</li>
                        <li><strong>תיבות סימון:</strong> אישור דרישת הגיל וההסכמה לתנאים אלו.</li>
                    </ul>
                    <p class="text-yellow-400 font-semibold mt-2">אין איסוף או שמירה של פרטים מזהים אישיים (שם מלא, אימייל, או מספר טלפון) על ידי פורטל זה, מאחר שאלו מטופלים במערכת הרישום של האתר הראשי.</p>

                    <h3 class="text-2xl font-bold text-white mt-6 mb-3">3. שימוש ואחסון בנתונים</h3>
                    <p>הנתונים הנאספים (תאריך לידה, סטטוס תיבות הסימון) נשלחים באופן מיידי למערכת הקצה שלנו (Netlify Forms, או מקביל) וזאת רק לצורך תיעוד אירוע האימות המוצלח. איננו מאחסנים נתונים אלו באופן מקומי. השימוש בהם הוא אך ורק לצורך עמידה ברגולציה ומתן גישה מיידית לאתר.</p>

                    <h3 class="text-2xl font-bold text-white mt-6 mb-3">4. תנאי גישה</h3>
                    <p>על ידי המשך הפעולה, אתה מאשר שאתה מעל גיל 18 ומסכים לכל התנאים של הפלטפורמה הראשית של Apollo. <strong>לידיעתך: מכירת מוצרים ושירותים מותרת רק על בסיס רישיון מוסדר ובתוקף.</strong> אתה תועבר מיידית לאתר הראשי.</p>
                `,
            }
        };

        // שינוי ברירת המחדל לעברית
        let currentLang = localStorage.getItem('apolloLang') || 'he';
        document.getElementById('lang-toggle').textContent = currentLang.toUpperCase() === 'EN' ? 'HE / EN' : 'EN / HE';

        // Get Policy Modal elements
        const policyModal = document.getElementById('policy-modal');
        const policyTitleElement = document.getElementById('policy-title');
        const policyContentElement = document.getElementById('policy-content');
        const closePolicyModalButton = document.getElementById('close-policy-modal');
        
        // Function to open the modal
        function openPolicyModal(e) {
            e.preventDefault(); 
            policyModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling the main page
        }

        // Function to close the modal
        function closePolicyModal() {
            policyModal.classList.add('hidden');
            document.body.style.overflow = ''; // Restore scrolling
        }


        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('apolloLang', lang);

            // 1. Update HTML dir and lang
            document.documentElement.setAttribute('lang', lang);
            document.documentElement.setAttribute('dir', lang === 'he' ? 'rtl' : 'ltr');
            
            // 2. Update all text elements
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const text = LANGUAGES[lang][key];

                if (element.tagName === 'TITLE') {
                    document.title = text;
                } else if (key === 'policyContent') {
                    // Special handling for policy content (HTML rich text)
                    element.innerHTML = text;
                } else {
                    // Update general text elements
                    element.innerHTML = text;
                }
            });

            // 3. Update the button text
            document.getElementById('lang-toggle').textContent = lang === 'en' ? 'HE / EN' : 'EN / HE';

             // 4. Update error message directionality dynamically
             const errorBox = document.getElementById('error-message');
             if (lang === 'he') {
                 errorBox.classList.add('text-right');
                 errorBox.classList.remove('text-left');
             } else {
                 errorBox.classList.add('text-left');
                 errorBox.classList.remove('text-right');
             }

             // 5. Update Checkbox label margin for LTR/RTL consistency
             document.querySelectorAll('.flex.items-start label').forEach(label => {
                 if (lang === 'he') {
                     label.classList.add('mr-3');
                     label.classList.remove('ml-3');
                 } else {
                     label.classList.add('ml-3');
                     label.classList.remove('mr-3');
                 }
             });
             
             // 6. Update Close button text based on lang
             closePolicyModalButton.textContent = lang === 'he' ? 'סגור (חזור לטופס)' : 'Close (Return to Form)';
        }

        // Initialize language on load
        switchLanguage(currentLang);

        // Language toggle event listener
        document.getElementById('lang-toggle').addEventListener('click', () => {
            const newLang = currentLang === 'en' ? 'he' : 'en';
            switchLanguage(newLang);
        });

        // =======================================================
        // 1. Configuration Constants
        // =======================================================
        
        // 1. The recipient of the lead details for the floating chat button
        const WHATSAPP_NUMBER = '972505328761'; 
        // 2. The URL to redirect the user to after successful lead capture
        const STORE_URL = 'https://apollosystem.io';

        // UI elements
        const successMessage = document.getElementById('success-message');
        const landingCard = document.getElementById('landing-card');
        const formElement = document.getElementById('ageGateFormNetlify'); 
        const errorMessage = document.getElementById('error-message');
        const completeActionButton = document.getElementById('completeAction');
        const whatsappFloatBtn = document.getElementById('whatsapp-float-btn'); 
        const adminViewBtn = document.getElementById('admin-view-btn'); 
        

        // =======================================================
        // 2. Verification and Form Submission Logic (Netlify Ready)
        // =======================================================

        formElement.addEventListener('submit', function(e) {
            e.preventDefault(); // מונע שליחה רגילה של הטופס

            const MINIMUM_AGE = 18; 
            
            const birthDateInput = document.getElementById('birthDate').value;
            const ageCheck = document.getElementById('ageCheck').checked;
            const termsCheck = document.getElementById('termsCheck').checked;
            
            const today = new Date();
            const birthDate = new Date(birthDateInput);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            // 1. Data Validation Check (Client Side)
            if (age < MINIMUM_AGE || !birthDateInput || !ageCheck || !termsCheck) {
                errorMessage.classList.remove('hidden');
                errorMessage.textContent = LANGUAGES[currentLang].errorMsg.replace(/<[^>]*>?/gm, "") + ` (${MINIMUM_AGE}+)`;
                return;
            }

            // אם האימות עבר בהצלחה (בצד הלקוח):
            errorMessage.classList.add('hidden');

            // --- A. Immediately show the success screen ---
            landingCard.classList.add('hidden');
            successMessage.classList.remove('hidden');
            
            // --- B. שליחה אסינכרונית ל-Netlify Forms API (רצה ברקע) ---
            const data = new FormData(e.target);
            const formActionUrl = window.location.href.split('#')[0];

            fetch(formActionUrl, { 
                method: 'POST',
                body: new URLSearchParams(data).toString(),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            })
            .then(response => {
                if (response.ok) {
                    console.log('Netlify form submission successful (minimal data).');
                } else {
                    // Log the error for debugging production deployment issues
                    console.warn(`Netlify Forms submission failed. Status: ${response.status}. UI simulation successful.`);
                }
            })
            .catch(error => {
                // This handles the expected 'Failed to fetch' error in the sandbox environment
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                     console.warn('Network error detected (expected in sandbox for Netlify submission). Lead capture simulated successfully.');
                } else {
                    console.error('Network or General Submission error:', error);
                }
            });
            
        });

        // 3. Action Button on Success Screen (Triggers IMMEDIATE Redirection)
        completeActionButton.addEventListener('click', () => {
            // Redirect the user to the store immediately.
            window.location.href = STORE_URL;
        });
        
        // 4. Floating WhatsApp Chat Button Logic
        whatsappFloatBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const chatMessage = "שלום, אני מעוניין/ת בגישה המיידית ל-Apollo ויש לי כמה שאלות. אשמח לקבל פרטים נוספים.";
            const encodedMessage = encodeURIComponent(chatMessage);
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
            // Open in a new tab
            window.open(whatsappUrl, '_blank');
        });

        // 5. Policy Modal Event Listeners
        // Use event delegation on the document body for policyLink, as the element gets re-rendered during language switch
        document.body.addEventListener('click', (e) => {
            // Fix: Added check to see if the element or any of its parents is the policy link.
            const policyLink = e.target.closest('#policyLink');
            if (policyLink) {
                console.log('POLICY LINK CLICKED. Attempting to open modal...'); // DIAGNOSTIC LOG
                openPolicyModal(e);
            }
        });
        
        closePolicyModalButton.addEventListener('click', closePolicyModal);

        // Allow closing modal with ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !policyModal.classList.contains('hidden')) {
                closePolicyModal();
            }
        });
    </script>
</body>
</html>
