<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Updated title to be dynamic based on language -->
    <title data-lang-key="pageTitle">Age Verification & Premium Coupon - Animated Background</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ×”×•×¡×¤×ª Font Awesome ×¢×‘×•×¨ ×œ×•×’×• WhatsApp ×¨×©××™ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* 1. Base Settings and Premium Dark Mode Background */
        body {
            font-family: 'Inter', sans-serif;
            position: relative;
            min-height: 100vh;
            background-color: #030303; /* Deep Black - Fallback */
            color: #e5e7eb; /* Light Text */
            padding-top: 1rem; /* Top spacing */
            padding-bottom: 8rem; /* Bottom spacing for fixed footer */
        }

        /* 2. New Animated Background Settings (Pure CSS) */
        .animated-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            /* Large gradient (400% 400%) for slow movement */
            background: linear-gradient(-45deg, #0d131f, #030303, #00E676, #0d131f);
            background-size: 400% 400%;
            opacity: 0.5; /* Keeps the glow subtle */
            transition: opacity 0.5s;
            animation: gradientMove 24s ease infinite; 
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 3. Overlay Layer - Dark and strong for readability */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* Aggressive layer to emphasize content */
            background-image: radial-gradient(circle at center, rgba(0, 230, 118, 0.02) 0%, rgba(3, 3, 3, 0.88) 70%);
            z-index: 15;
        }
        
        /* 4. Brand Design and Colors */
        .brand-green { background-color: #00E676; } 
        .brand-green:hover { background-color: #00c765; }
        .whatsapp-green { background-color: #25D366; }
        .whatsapp-green:hover { background-color: #128C7E; }

        /* 5. Central Card Design (Glass-morphism) */
        .modal-card {
            z-index: 20;
            backdrop-filter: blur(20px); 
            background-color: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(0, 230, 118, 0.5);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            margin-top: 3rem;
            margin-bottom: 3rem;
        }

        /* 6. Input Field Styling */
        .form-input {
            background-color: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(156, 163, 175, 0.3); 
            color: #fff;
        }
        .form-input:focus {
            background-color: #1f2937;
            border-color: #00E676;
            box-shadow: 0 0 0 1px #00E676;
        }

        /* Neon CTA Button */
        .neon-cta-button {
            box-shadow: 0 0 20px rgba(37, 211, 102, 0.6), inset 0 0 10px rgba(37, 211, 102, 0.4); 
        }
        .neon-cta-button:hover {
            box-shadow: 0 0 30px rgba(37, 211, 102, 0.8), inset 0 0 15px rgba(37, 211, 102, 0.6);
        }

        /* Message Box / Modals - General Styling */
        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            width: 90%;
            max-width: 400px;
            text-align: left;
        }

        /* 7. Footer - Fixed to the bottom, allowing body content to scroll */
        .footer-fixed {
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 30;
        }
        
        /* Specific Admin Panel Styling */
        .lead-item {
            border-bottom: 1px solid #1f2937; /* Dark border separator */
        }
        
        /* 8. Floating WhatsApp Button Style */
        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 20px;
            right: 20px; /* Standard bottom-right position */
            background-color: #25D366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            /* Font size applies to the icon inside */
            font-size: 30px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(37, 211, 102, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0);
            }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-start p-4 min-h-screen">
    
    <!-- 1. Language Switcher Button - Fixed top-right/left -->
    <button id="lang-toggle" class="fixed top-4 right-4 z-50 p-2 bg-gray-700/80 backdrop-blur-sm rounded-full text-white font-bold text-sm shadow-lg hover:bg-gray-600 transition duration-150">
        HE / EN
    </button>
    
    <!-- Admin Button - Peace Dove Icon (Top Left, Small and Subtle) -->
    <button id="admin-view-btn" class="fixed top-4 left-4 z-50 p-2 bg-gray-900/70 backdrop-blur-sm rounded-full text-xl shadow-lg hover:bg-gray-800 transition duration-150" aria-label="Admin View">
        ğŸ•Šï¸
    </button>

    <!-- Loading/Status Message -->
    <div id="loading-message" class="message-box bg-gray-800 p-4 rounded-lg shadow-xl border border-yellow-500 hidden">
        <p class="text-lg text-yellow-300 font-bold" data-lang-key="loadingTitle">Animated Background Loading...</p>
        <p class="text-sm text-gray-400" data-lang-key="loadingText">Form displayed successfully.</p>
    </div>

    <!-- Success Message - Hidden by default -->
    <div id="success-message" class="message-box bg-gray-900 p-8 rounded-xl shadow-2xl border border-brand-green hidden">
        <h2 class="text-3xl font-extrabold text-white mb-3" data-lang-key="successTitle">âœ… ××™××•×ª ×”×¦×œ×—×”!</h2>
        <p class="text-gray-300 text-lg mb-4" data-lang-key="successText">×¤×¨×˜×™×š × ×¨×©××• ×‘×”×¦×œ×—×”. ×§×•×“ ×”×”× ×—×” ×”×‘×œ×¢×“×™ ×©×œ×š ×”×•×:</p>
        
        <!-- Coupon Display Block -->
        <div class="bg-brand-green/20 p-4 rounded-xl mb-6 border border-brand-green text-center">
            <p class="text-sm text-gray-200 mb-1" data-lang-key="couponLabel">×§×•×“ ×§×•×¤×•×Ÿ:</p>
            <p class="text-3xl font-black text-brand-green tracking-widest" id="coupon-display">547A58</p>
        </div>
        <!-- End Coupon Display -->

        <p class="text-gray-400 mb-6" data-lang-key="successFinalCta">
            ×”×¤×¨×˜×™× ×©×œ×š × ×©××¨×• ×‘×”×¦×œ×—×” ×‘××¢×¨×›×ª. ×œ×—×¥ ××˜×” ×œ××¢×‘×¨ ××™×™×“×™ ×œ××ª×¨ ×•×©×™××•×© ×‘×§×•×“ ×”×§×•×¤×•×Ÿ ×©×”×•×¦×’.
        </p>

        <button id="completeAction" class="neon-cta-button w-full flex justify-center items-center py-3 px-6 rounded-xl text-lg font-black text-gray-900 brand-green focus:outline-none focus:ring-8 focus:ring-offset-2 focus:ring-whatsapp-green/70 transition duration-300 ease-in-out" data-lang-key="successButton">
            ××¢×‘×¨ ××™×™×“×™ ×œ××ª×¨ ×•×©×™××•×© ×‘×§×•×¤×•×Ÿ
        </button>
    </div>

    <!-- Admin Code Input Modal (Replaces prompt()) -->
    <div id="admin-input-modal" class="message-box bg-gray-900 p-8 rounded-xl shadow-2xl border border-red-500 hidden">
        <h2 class="text-2xl font-extrabold text-red-300 mb-4 text-center">ğŸ” Admin Access Required</h2>
        <form id="admin-password-form" class="space-y-4">
            <input type="password" id="admin-password-input" class="form-input w-full p-3 rounded-xl text-lg text-center tracking-wider" placeholder="×”×›× ×¡ ×§×•×“ ×’×™×©×”">
            <div id="password-error" class="text-red-400 text-sm hidden text-center font-semibold">×§×•×“ ×©×’×•×™. × ×¡×” ×©×•×‘.</div>
            <button type="submit" class="w-full py-3 bg-red-600 rounded-xl font-bold text-white hover:bg-red-700 transition duration-150">×›× ×™×¡×”</button>
        </form>
        <button id="cancel-admin-input" class="mt-4 w-full py-1 text-sm text-gray-500 hover:text-gray-300 transition duration-150">×‘×™×˜×•×œ</button>
    </div>

    <!-- Admin Panel Modal - Hidden by default -->
    <div id="admin-panel" class="message-box bg-gray-900/90 p-6 rounded-xl shadow-2xl border border-red-500 hidden max-w-lg">
        <h2 class="text-2xl font-extrabold text-red-300 mb-4 text-center">Admin Leads Data</h2>
        <div id="leads-list" class="space-y-3 max-h-80 overflow-y-auto p-3 border border-gray-700 rounded-lg">
            <p class="text-gray-400 text-center">Loading leads...</p>
        </div>
        <button id="close-admin-btn" class="mt-4 w-full py-2 bg-red-600 rounded-lg font-bold hover:bg-red-700 transition duration-150">Close</button>
    </div>


    <!-- 1. Animated Background (CSS Gradient) -->
    <div class="animated-background"></div>

    <!-- 2. Dark Overlay Layer -->
    <div class="overlay"></div>

    <!-- Central Landing Card -->
    <div id="landing-card" class="modal-card max-w-lg w-full rounded-3xl p-10 space-y-8">

        <!-- Main Title H1: The Promise -->
        <h1 class="text-4xl font-extrabold text-white text-center leading-snug tracking-wide" data-lang-key="mainTitle">
            ğŸŒ¿ ×¤×•×¨×˜×œ ×¤×¨×™××™×•× : ×§×•×“ ×§×•×¤×•×Ÿ ××™×™×“×™ ×•×’×™×©×” ×œ-Apollo
        </h1>

        <!-- Subtitle H2: Emphasis on Responsibility -->
        <p class="text-gray-300 text-center text-base font-light" data-lang-key="subtitle">
            ×‘×”×ª×× ×œ×¨×’×•×œ×¦×™×”: ×× × ××©×¨/×™ ××ª ×’×™×œ×š (**18+**) ×•×”×¡×›××ª×š ×”××œ××” ×œ×ª× ××™ ×”×©×™××•×© ×©×œ× ×• ×›×“×™ ×œ×”×©×œ×™× ××ª ×”×”×¨×©××”.
        </p>

        <!-- Verification and Lead Form -->
        <form id="ageGateForm" class="space-y-6">
            <!-- Global Error Messages -->
            <div id="error-message" class="hidden p-4 bg-red-900/50 border border-red-500 text-red-300 rounded-lg text-sm text-left font-semibold" data-lang-key="errorMsg">
                ××™××•×ª × ×›×©×œ. ×× × ×•×“×/×™ ×©××ª×” ××¢×œ ×’×™×œ 18 ×•×©×›×œ ×©×“×•×ª ×”×—×•×‘×” ×¡×•×× ×• ×•××•×œ××• ×›×¨××•×™.
            </div>

            <!-- 1. Age Verification (Required Field) -->
            <div class="space-y-2">
                <label for="birthDate" class="block text-sm font-bold text-gray-200" data-lang-key="labelBirthDate">1. ×ª××¨×™×š ×œ×™×“×” ××œ× (DD/MM/YYYY):</label>
                <input type="date" id="birthDate" name="birthDate" required class="form-input mt-1 block w-full px-4 py-3 rounded-xl focus:outline-none text-lg placeholder-gray-500">
            </div>

            <!-- 2. Lead Capture (WhatsApp Phone Number - Required Field) -->
            <div class="space-y-2">
                <label for="phoneNumber" class="block text-sm font-bold text-gray-200" data-lang-key="labelPhone">2. ××¡×¤×¨ ×˜×œ×¤×•×Ÿ (×•×•××˜×¡××¤) ×œ×©×œ×™×—×ª ×”×œ×™×“:</label>
                <!-- ADDED maxlength="14" -->
                <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="05X-XXXXXXX" minlength="9" maxlength="14" class="form-input mt-1 block w-full px-4 py-3 rounded-xl focus:outline-none text-lg placeholder-gray-500" data-lang-key="placeholderPhone" data-placeholder-en="+1 (555) 555-5555" data-placeholder-he="05X-XXXXXXX">
            </div>

            <!-- 3. Full Name (Optional) -->
            <div class="space-y-2">
                <label for="fullName" class="block text-sm font-medium text-gray-400" data-lang-key="labelName">3. ×©× ××œ× (××•×¤×¦×™×•× ×œ×™):</label>
                <!-- ADDED maxlength="20" -->
                <input type="text" id="fullName" name="fullName" placeholder="×©××š ×”××œ×" maxlength="20" class="form-input mt-1 block w-full px-4 py-3 rounded-xl focus:outline-none placeholder-gray-500" data-lang-key="placeholderName" data-placeholder-en="Your Full Name" data-placeholder-he="×©××š ×”××œ×">
            </div>


            <!-- 4. Regulatory Terms Approval (Checkboxes) -->
            <div class="space-y-4 pt-3 text-left">
                <div class="flex items-start">
                    <input id="ageCheck" name="ageCheck" type="checkbox" required class="h-5 w-5 text-brand-green border-gray-600 rounded focus:ring-brand-green mt-1 bg-gray-700">
                    <label for="ageCheck" class="ml-3 text-base text-gray-300 cursor-pointer font-semibold" data-lang-key="checkAge">
                        ×× ×™ ×××©×¨/×ª ×©×× ×™ ×¢×•××“/×ª ×‘×“×¨×™×©×•×ª ×’×™×œ ×”××™× ×™××•× ×”×—×•×§×™ (**18+**).
                    </label>
                </div>
                <div class="flex items-start">
                    <input id="termsCheck" name="termsCheck" type="checkbox" required class="h-5 w-5 text-brand-green border-gray-600 rounded focus:ring-brand-green mt-1 bg-gray-700">
                    <label for="termsCheck" class="ml-3 text-base text-gray-300 cursor-pointer font-semibold" data-lang-key="checkTerms">
                        ×× ×™ ×××©×¨/×ª ×©×§×¨××ª×™ ×•×”×¡×›××ª×™ ×œ<a href="#terms-and-privacy" class="text-brand-green hover:underline font-bold transition duration-150">×ª× ××™ ×”×©×™××•×© ×•××“×™× ×™×•×ª ×”×¤×¨×˜×™×•×ª</a>.
                    </label>
                </div>
            </div>

            <!-- Call to Action (CTA) Button - Strong Neon -->
            <button type="submit" class="neon-cta-button w-full flex justify-center items-center py-4 px-6 rounded-xl text-xl font-black text-gray-900 brand-green focus:outline-none focus:ring-8 focus:ring-offset-2 focus:ring-whatsapp-green/70 transition duration-300 ease-in-out transform hover:scale-[1.02]" data-lang-key="ctaButton">
                ××™×©×•×¨ ×•×§×‘×œ×ª ×’×™×©×” ××™×™×“×™×ª
            </button>
        </form>

        <!-- Medical Disclaimer at the bottom of the card -->
        <p class="text-xs text-gray-500 text-center pt-2" data-lang-key="disclaimer">
            ×¡×™×™×’: ×”××™×“×¢ ××™× ×• ××”×•×•×” ×™×™×¢×•×¥ ×¨×¤×•××™ ××• ××©×¤×˜×™.
        </p>
    </div>

    <!-- Enhanced Footer with dark background - positioned fixed to bottom -->
    <footer id="terms-and-privacy" class="footer-fixed bg-gray-900/95 backdrop-blur-lg p-3 text-center text-xs text-gray-500 border-t border-gray-800 shadow-2xl">
        <span data-lang-key="footerLine1">&copy; APOLLO |×›×™×•×•× ×™× ×—×‘×¨×ª ×”×¤×¦×” ××©× ×ª 2020. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.</span>
        <br>
        <span data-lang-key="footerLine2">×”×©×™××•×© ×‘××ª×¨ ×›×¤×•×£ ×œ×—×•×§×™× ×”××§×•××™×™× ×•××•×ª×¨ ×¨×§ ×œ××©×ª××©×™× **××¢×œ ×’×™×œ 18**.</span>
    </footer>

    <!-- Floating WhatsApp Chat Button - Updated to use Font Awesome Logo -->
    <a href="#" id="whatsapp-float-btn" class="whatsapp-float hover:scale-110 transition duration-200" title="×¦×³××˜ ××”×™×¨ ×‘×•×•××˜×¡××¤">
        <!-- Official WhatsApp Icon from Font Awesome -->
        <i class="fab fa-whatsapp"></i>
    </a>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // IMPORTED getDocs and query for Admin View
        import { getFirestore, collection, addDoc, serverTimestamp, getDocs, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // =======================================================
        // 0. Language Configuration
        // =======================================================
        const LANGUAGES = {
            'en': {
                'pageTitle': 'Age Verification & Premium Coupon - Animated Background',
                'mainTitle': 'ğŸŒ¿ Premium Portal Unlocked: Instant Coupon Code and Apollo Access',
                'subtitle': 'As required by regulation: Please verify your age **(18+)** and full agreement to our Terms of Use to complete registration.',
                'errorMsg': 'Verification failed. Please ensure you are over 18 and all required fields are correctly marked and filled.',
                'labelBirthDate': '1. Full Date of Birth (DD/MM/YYYY):',
                'labelPhone': '2. Phone Number (WhatsApp) for lead submission:',
                'placeholderPhone': '+1 (555) 555-5555',
                'labelName': '3. Full Name (Optional):',
                'placeholderName': 'Your Full Name',
                'checkAge': 'I confirm that I meet the legal minimum age requirement **(18+)**.',
                'checkTerms': 'I confirm that I have read and agreed to the <a href="#terms-and-privacy" class="text-brand-green hover:underline font-bold transition duration-150">Terms of Use and Privacy Policy</a>.',
                'ctaButton': 'Confirm and Get Instant Access',
                'disclaimer': 'Disclaimer: The information does not constitute medical or legal advice.',
                'footerLine1': '&copy; APOLLO | Distribution Company since 2020. All rights reserved.',
                'footerLine2': 'Use of this website is subject to local laws and is permitted only for users **aged 18 and over**.',
                'successTitle': 'âœ… Success Confirmed!',
                'successText': 'Your details have been registered. Your exclusive discount code is:',
                'couponLabel': 'Coupon Code:',
                'successFinalCta': 'Your details have been successfully saved to the system. Click below for immediate redirection to the store and to use the displayed coupon code.',
                'successButton': 'Instant Redirection to Store and Coupon Use',
                'loadingTitle': 'Animated Background Loading...',
                'loadingText': 'Form displayed successfully.'
            },
            'he': {
                'pageTitle': '××™××•×ª ×’×™×œ ×•×§×•×¤×•×Ÿ ×¤×¨×™××™×•× - ×¨×§×¢ ××•× ×¤×©',
                'mainTitle': 'ğŸŒ¿ ×¤×•×¨×˜×œ ×¤×¨×™××™×•× × ×¤×ª×—: ×§×•×“ ×§×•×¤×•×Ÿ ××™×™×“×™ ×•×’×™×©×” ×œ-Apollo',
                'subtitle': '×‘×”×ª×× ×œ×¨×’×•×œ×¦×™×”: ×× × ××©×¨/×™ ××ª ×’×™×œ×š (**18+**) ×•×”×¡×›××ª×š ×”××œ××” ×œ×ª× ××™ ×”×©×™××•×© ×©×œ× ×• ×›×“×™ ×œ×”×©×œ×™× ××ª ×”×”×¨×©××”.',
                'errorMsg': '××™××•×ª × ×›×©×œ. ×× × ×•×“×/×™ ×©××ª×” ××¢×œ ×’×™×œ 18 ×•×©×›×œ ×©×“×•×ª ×”×—×•×‘×” ×¡×•×× ×• ×•××•×œ××• ×›×¨××•×™.',
                'labelBirthDate': '1. ×ª××¨×™×š ×œ×™×“×” ××œ× (DD/MM/YYYY):',
                'labelPhone': '2. ××¡×¤×¨ ×˜×œ×¤×•×Ÿ (×•×•××˜×¡××¤) ×œ×©×œ×™×—×ª ×”×œ×™×“:',
                'placeholderPhone': '05X-XXXXXXX',
                'labelName': '3. ×©× ××œ× (××•×¤×¦×™×•× ×œ×™):',
                'placeholderName': '×©××š ×”××œ×',
                'checkAge': '×× ×™ ×××©×¨/×ª ×©×× ×™ ×¢×•××“/×ª ×‘×“×¨×™×©×•×ª ×’×™×œ ×”××™× ×™× ×™××•× ×”×—×•×§×™ (**18+**).',
                'checkTerms': '×× ×™ ×××©×¨/×ª ×©×§×¨××ª×™ ×•×”×¡×›××ª×™ ×œ<a href="#terms-and-privacy" class="text-brand-green hover:underline font-bold transition duration-150">×ª× ××™ ×”×©×™××•×© ×•××“×™× ×™×•×ª ×”×¤×¨×˜×™×•×ª</a>.',
                'ctaButton': '××™×©×•×¨ ×•×§×‘×œ×ª ×’×™×©×” ××™×™×“×™×ª',
                'disclaimer': '×¡×™×™×’: ×”××™×“×¢ ××™× ×• ××”×•×•×” ×™×™×¢×•×¥ ×¨×¤×•××™ ××• ××©×¤×˜×™.',
                'footerLine1': '&copy; APOLLO | ×—×‘×¨×ª ×”×¤×¦×” ××©× ×ª 2020. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª.',
                'footerLine2': '×”×©×™××•×© ×‘××ª×¨ ×›×¤×•×£ ×œ×—×•×§×™× ×”××§×•××™×™× ×•××•×ª×¨ ×¨×§ ×œ××©×ª××©×™× **××¢×œ ×’×™×œ 18**.',
                'successTitle': 'âœ… ××™××•×ª ×”×¦×œ×—×”!',
                'successText': '×¤×¨×˜×™×š × ×¨×©××• ×‘×”×¦×œ×—×”. ×§×•×“ ×”×”× ×—×” ×”×‘×œ×¢×“×™ ×©×œ×š ×”×•×:',
                'couponLabel': '×§×•×“ ×§×•×¤×•×Ÿ:',
                'successFinalCta': '×”×¤×¨×˜×™× ×©×œ×š × ×©××¨×• ×‘×”×¦×œ×—×” ×‘××¢×¨×›×ª. ×œ×—×¥ ××˜×” ×œ××¢×‘×¨ ××™×™×“×™ ×œ××ª×¨ ×•×©×™××•×© ×‘×§×•×“ ×”×§×•×¤×•×Ÿ ×©×”×•×¦×’.',
                'successButton': '××¢×‘×¨ ××™×™×“×™ ×œ××ª×¨ ×•×©×™××•×© ×‘×§×•×¤×•×Ÿ', 
                'loadingTitle': '×˜×¢×™× ×ª ×¨×§×¢ ××•× ×¤×©...',
                'loadingText': '×”×˜×•×¤×¡ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”.'
            }
        };

        let currentLang = localStorage.getItem('apolloLang') || 'en';
        document.getElementById('lang-toggle').textContent = currentLang.toUpperCase() === 'EN' ? 'HE / EN' : 'EN / HE';

        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('apolloLang', lang);

            // 1. Update HTML dir and lang
            document.documentElement.setAttribute('lang', lang);
            document.documentElement.setAttribute('dir', lang === 'he' ? 'rtl' : 'ltr');
            
            // 2. Update all text elements
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const text = LANGUAGES[lang][key];

                if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                    // Handle placeholders (using a specific data attribute for input placeholders)
                    element.setAttribute('placeholder', element.getAttribute(`data-placeholder-${lang}`));
                } else if (element.tagName === 'TITLE') {
                    // Handle page title
                    document.title = text;
                } else {
                    // Use innerHTML for text that contains an anchor tag (like terms check)
                    element.innerHTML = text;
                }
            });

            // 3. Update the button text
            document.getElementById('lang-toggle').textContent = lang === 'en' ? 'HE / EN' : 'EN / HE';

             // 4. Update error message directionality dynamically
             const errorBox = document.getElementById('error-message');
             if (lang === 'he') {
                errorBox.classList.add('text-right');
                errorBox.classList.remove('text-left');
             } else {
                errorBox.classList.add('text-left');
                errorBox.classList.remove('text-right');
             }

             // 5. Update Checkbox label margin for LTR/RTL consistency
             document.querySelectorAll('.flex.items-start label').forEach(label => {
                if (lang === 'he') {
                    label.classList.add('mr-3');
                    label.classList.remove('ml-3');
                } else {
                    label.classList.add('ml-3');
                    label.classList.remove('mr-3');
                }
             });
        }

        // Initialize language on load
        switchLanguage(currentLang);

        // Language toggle event listener
        document.getElementById('lang-toggle').addEventListener('click', () => {
            const newLang = currentLang === 'en' ? 'he' : 'en';
            switchLanguage(newLang);
        });

        // =======================================================
        // 1. Firebase Initialization and Authentication
        // =======================================================
        
        // --- ADMIN CONFIGURATION ---
        // 1. The recipient of the lead details for the floating chat button
        const WHATSAPP_NUMBER = '972505328761'; 
        // 2. The coupon code displayed to the successful registrant
        const COUPON_CODE = '547A58'; 
        // 3. The URL to redirect the user to after successful lead capture
        const STORE_URL = 'https://apollosystem.io';

        // Set coupon display element immediately
        document.getElementById('coupon-display').textContent = COUPON_CODE;


        // Global variables required by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

        // Firebase variables
        let db;
        let auth;
        let isFirebaseReady = false;

        // UI elements
        const successMessage = document.getElementById('success-message');
        const landingCard = document.getElementById('landing-card');
        const formElement = document.getElementById('ageGateForm');
        const errorMessage = document.getElementById('error-message');
        const completeActionButton = document.getElementById('completeAction');
        const adminViewBtn = document.getElementById('admin-view-btn');
        const adminPanel = document.getElementById('admin-panel');
        const closeAdminBtn = document.getElementById('close-admin-btn');
        const leadsList = document.getElementById('leads-list');
        const whatsappFloatBtn = document.getElementById('whatsapp-float-btn'); 
        
        // ADMIN INPUT UI ELEMENTS
        const adminInputModal = document.getElementById('admin-input-modal');
        const adminPasswordForm = document.getElementById('admin-password-form');
        const adminPasswordInput = document.getElementById('admin-password-input');
        const passwordError = document.getElementById('password-error');
        const cancelAdminInputBtn = document.getElementById('cancel-admin-input');
        const ADMIN_CODE = '9876';

        
        if (Object.keys(firebaseConfig).length > 0) {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Authenticate user using Custom Token or Anonymous Sign-In
            const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
            
            const authenticate = (signInFunc) => {
                signInFunc(auth, token)
                    .then(() => {
                        isFirebaseReady = true;
                        console.log("Firebase signed in successfully.");
                    })
                    .catch(error => {
                        console.error("Firebase authentication error:", error);
                        // If token sign-in fails, try anonymous sign-in
                        signInAnonymously(auth).then(() => {
                            isFirebaseReady = true;
                            console.log("Firebase signed in anonymously as fallback.");
                        });
                    });
            };

            if (token) {
                authenticate(signInWithCustomToken);
            } else {
                authenticate(signInAnonymously);
            }
        } else {
            console.error("Firebase config is missing or empty. Leads will not be saved.");
        }


        // =======================================================
        // 2. Lead Saving Logic
        // =======================================================
        async function saveLead(data) {
            if (!isFirebaseReady || !db) {
                console.error("Firestore not ready or initialized. Cannot save lead.");
                return false;
            }

            try {
                // IMPORTANT: Use the authenticated user's ID for secure storage
                const userId = auth.currentUser?.uid || 'anonymous';
                // Path: /artifacts/{appId}/users/{userId}/leads
                const leadsCollectionRef = collection(db, 'artifacts', appId, 'users', userId, 'leads');
                
                await addDoc(leadsCollectionRef, {
                    name: data.name,
                    phone: data.phone,
                    birthDate: data.birthDate,
                    age: data.age,
                    timestamp: serverTimestamp(),
                    source: `ApolloLandingPage_${currentLang.toUpperCase()}`,
                    coupon: COUPON_CODE // Save the coupon code used
                });

                console.log("Lead saved successfully to Firestore.");
                return true;
            } catch (e) {
                console.error("Error adding document to Firestore: ", e);
                return false;
            }
        }

        // =======================================================
        // 3. Verification and Form Submission Logic
        // =======================================================

        formElement.addEventListener('submit', async function(e) {
            e.preventDefault();

            const MINIMUM_AGE = 18; 
            
            const birthDateInput = document.getElementById('birthDate').value;
            // Remove non-numeric characters for cleaner storage/use
            const phoneNumberInput = document.getElementById('phoneNumber').value.replace(/[^0-9+]/g, ''); 
            const fullNameInput = document.getElementById('fullName').value;
            const ageCheck = document.getElementById('ageCheck').checked;
            const termsCheck = document.getElementById('termsCheck').checked;

            const today = new Date();
            const birthDate = new Date(birthDateInput);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            // 1. Data Validation Check
            if (age < MINIMUM_AGE || !birthDateInput || phoneNumberInput.length < 9 || !ageCheck || !termsCheck) {
                errorMessage.classList.remove('hidden');
                // Use the localized error message and ensure it includes the age requirement
                errorMessage.textContent = LANGUAGES[currentLang].errorMsg.replace(/<[^>]*>?/gm, "") + ` (${MINIMUM_AGE}+)`;
                return;
            }

            errorMessage.classList.add('hidden');

            // 2. Save Lead to Firestore
            const leadData = {
                name: fullNameInput || '×œ× ×¡×•×¤×§',
                phone: phoneNumberInput,
                birthDate: birthDateInput,
                age: age,
            };
            
            await saveLead(leadData);

            // 3. Handle Success: Show success screen
            landingCard.classList.add('hidden');
            successMessage.classList.remove('hidden');

        });

        // 4. Action Button on Success Screen (Triggers IMMEDIATE Redirection)
        completeActionButton.addEventListener('click', () => {
             // Redirect the user to the store immediately.
             window.location.href = STORE_URL;
        });
        
        // 5. Floating WhatsApp Chat Button Logic
        whatsappFloatBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const chatMessage = "×©×œ×•×, ×× ×™ ××¢×•× ×™×™×Ÿ/×ª ×‘×”×¦×¢×ª ×¤×•×¨×˜×œ ×”×¤×¨×™××™×•× ×©×œ Apollo ×•×™×© ×œ×™ ×›××” ×©××œ×•×ª. ××©××— ×œ×§×‘×œ ×¤×¨×˜×™ ×’×™×©×”.";
            const encodedMessage = encodeURIComponent(chatMessage);
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
            // Open in a new tab
            window.open(whatsappUrl, '_blank');
        });


        // =======================================================
        // 6. ADMIN VIEW LOGIC
        // =======================================================
        
        async function fetchAndRenderLeads() {
            leadsList.innerHTML = '<p class="text-yellow-400 text-center">×˜×•×¢×Ÿ ×œ×™×“×™×... (Loading leads...)</p>';

            if (!isFirebaseReady || !db || !auth.currentUser) {
                leadsList.innerHTML = '<p class="text-red-400 text-center">×©×’×™××”: Firebase ×œ× ××•×›×Ÿ ××• ×©×œ× ×”×ª×—×‘×¨×ª ×›××©×ª××© ×”××•×’×“×¨.</p>';
                return;
            }

            try {
                const userId = auth.currentUser.uid;
                // Querying YOUR secured leads path
                const leadsCollectionRef = collection(db, 'artifacts', appId, 'users', userId, 'leads');
                const q = query(leadsCollectionRef); // No orderBy to avoid needing indexes

                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    leadsList.innerHTML = '<p class="text-gray-400 text-center">×˜×¨× × ×©××¨×• ×œ×™×“×™×.</p>';
                    return;
                }

                let html = '';
                querySnapshot.forEach((doc, index) => {
                    const data = doc.data();
                    const timestamp = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleString('he-IL') : '××™×“ (now)';
                    
                    html += `
                        <div class="lead-item p-2 rounded-lg bg-gray-800 hover:bg-gray-700/70 transition duration-100">
                            <p class="text-sm font-bold text-white">${index + 1}. ${data.name || '---'}</p>
                            <p class="text-xs text-brand-green">ğŸ“± ${data.phone}</p>
                            <p class="text-xs text-gray-400">ğŸ‚ ×’×™×œ: ${data.age}, ×ª. ×œ×™×“×”: ${data.birthDate}</p>
                            <p class="text-xs text-yellow-400">ğŸ·ï¸ ×§×•×¤×•×Ÿ: ${data.coupon || COUPON_CODE}</p>
                            <p class="text-xs text-gray-500">â° × ×©××¨ ×‘: ${timestamp}</p>
                        </div>
                    `;
                });
                
                leadsList.innerHTML = html;
            } catch (error) {
                console.error("Error fetching leads:", error);
                leadsList.innerHTML = `<p class="text-red-400 text-center">×©×’×™××” ×‘××—×–×•×¨ × ×ª×•× ×™×: ${error.message}</p>`;
            }
        }


        // Event Listeners for Admin Input Modal (Dove Button)
        adminViewBtn.addEventListener('click', () => {
            // 1. Hide all main content
            landingCard.classList.add('hidden');
            successMessage.classList.add('hidden');
            adminPanel.classList.add('hidden');
            
            // 2. Show password input modal
            adminInputModal.classList.remove('hidden');
            adminPasswordInput.value = ''; // Clear previous input
            passwordError.classList.add('hidden');
            adminPasswordInput.focus();
        });

        // Event Listener for Password Form Submission
        adminPasswordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const enteredPassword = adminPasswordInput.value;

            if (enteredPassword === ADMIN_CODE) {
                // Success: Hide input modal, show admin panel
                adminInputModal.classList.add('hidden');
                adminPanel.classList.remove('hidden');
                fetchAndRenderLeads();
            } else {
                // Failure: Show error, clear input
                passwordError.classList.remove('hidden');
                adminPasswordInput.value = '';
                adminPasswordInput.focus();
            }
        });

        // Event Listener for Cancel Button on Admin Input Modal
        cancelAdminInputBtn.addEventListener('click', () => {
            // Hide input modal, return to the main form
            adminInputModal.classList.add('hidden');
            landingCard.classList.remove('hidden');
        });

        // Event Listener for Close Button on Admin Panel
        closeAdminBtn.addEventListener('click', () => {
            // Close the admin panel, return to the main form
            adminPanel.classList.add('hidden');
            landingCard.classList.remove('hidden');
        });

    </script>
</body>
</html>
